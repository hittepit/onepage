<html ng-app>
	<head>
		<title>Gestion des langues</title>
		<script src="angular.min.js"></script>
		<script>
				
		function LanguageCtrl($scope,$http) {
			$scope.codeError ='';
			$http.get('/languages/list').success(function(data){
				$scope.languages = data;
			});
			
			$scope.add = function(language) {
				var d = {
					key: language.code,
					name: language.name
				};
				$http.post('/languages',d).success(function(data,status){
					$scope.message = data.messages
					if(data.status=="ok"){
						$scope.codeError ='';
						$scope.languages.push({"key":language.code, "name":language.name});
						language.code='';
						language.name='';
					} else {
						if(data.errors.codeError){
							$scope.codeError ='error';
						}
						if(data.errors.nameError){
							$scope.nameError = 'error';
						}
					}
				});
			};
		};
		</script>
		<link rel="stylesheet" href="people.css">
	</head>
	<body ng-controller="LanguageCtrl">
		<h1>Liste des langues disponibles</h1>
		<table class="people">
			<tr><th>Code</th><th>Langue</th></tr>
			<tr ng-repeat="language in languages" ng-class="{0:'even',1:'odd'}[$index % 2]">
				<td>{{language.key}}</td>
				<td>{{language.name}}</td>
			</tr>
		</table>
		
		<form name="la" novalidate>
			<h2>Ajouter une langue</h2>
			<span id="message">
			<ul ng-repeat="m in message">
				<li>{{m}}</li>
			</ul>
			</span><br />
			Code: <input type="text" ng-model="language.code" class="{{codeError}}" required/><br/>
			Langue: <input type="text" ng-model="language.name" class="{{nameError}}" required/><br />
			<button ng-click="add(language)" ng-disabled="la.$invalid">Ajouter</button>
		</form>
	</body>
<html>